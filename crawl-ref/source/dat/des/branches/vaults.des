###############################################################################
# vaults.des: Entries to the Vaults branch.
#
# Note the regular (mini)vaults are no longer in vaults.des, they have been
# moved to mini.des, float.des and large.des. Portal vaults live in portal.des.
###############################################################################

{{
  -- Vaults:$ common loot substitutions
  function vaults_end_loot(e)
    e.subst("? = | * .:40 ^:3")
    e.subst("| = | *:2")
    e.subst("* = * |:2")
  end

  -- Vaults:$ cross-vault rune substitution
  -- Turn 'O' into a rune (if it doesn't exist yet) or a good item
  --
  -- Note that this assumes that only one "prize" subvault is ever picked, and
  -- that it is the first subvault of the four.
  function vaults_end_rune(e)
    if dgn.map_by_tag("vaults_end_rune")
       and (e.has_tag("vaults_end_quadrant_prize")
              and crawl.one_chance_in(4)
            or e.has_tag("vaults_end_quadrant"))
    then
      e.subvault("O : vaults_end_rune")
    else
      e.subvault("O : vaults_end_norune")
    end
  end

  -- Find the slave of the teleporter and move to it.
  function teleporter_vault_action_fn(data, triggerable, triggerer, marker, ev)
    local position = dgn.point(marker:pos())
    my_slaves = dgn.find_marker_positions_by_prop("teleport_spot",
                                                  data.teleport_spot)

    if you.teleport_to(my_slaves[1].x, my_slaves[1].y, true) then
      crawl.mpr("Your surroundings suddenly seem different!")
    else
      crawl.mpr("There is a strange hissing noise.")
    end
  end

}}

###############################################################################
# Vaults entries
###############################################################################

############################################################
# Generic Vaults entry
#
NAME:    david_vaults_1
TAGS:    vaults_entry
MONS:    hill giant / troll / two-headed ogre
MONS:    necromancer / wizard / vampire w:4 / deep elf mage w:4
SHUFFLE: !-
SUBST:   ! = x, - = +, c : cxv
NSUBST:  1 = 1:1 / * = 1.., 2 = 1:2 / * = 2..
KFEAT:   O = enter_vaults
MAP
xxxxx.@.ccccc
x...+...c..2c
x...x...c...c
x!x-x.1.c...c
@.x.x12.+.O1c
x.x.x.1.c...c
x.x.x...c...c
x.+.x...c..2c
xxxxx.@.ccccc
ENDMAP

############################################################
# Vault monsters near stair
#
NAME: david_vaults_2
TAGS: vaults_entry
MONS: yaktaur captain, yaktaur, ogre mage, two-headed ogre
MONS: glowing shapeshifter, shapeshifter
SHUFFLE: 12 / 34 / 56
KFEAT:   O = enter_vaults
MAP
vvvvv.@....
v1.........
v..........
v.....2v.v.
@....2Ov..@
.....vvv.v.
...........
.....v.v.v.
......@....
ENDMAP

############################################################
# Vaults patterns 0: vanguard
#
NAME:    david_vaults_3
TAGS:    vaults_entry
MONS:    human
KMONS:   2 = orc knight / Donald, orc knight
KMONS:   3 = skeletal warrior w:20 / Norris, skeletal warrior
KMONS:   4 = hill giant / Rupert, hill giant
SHUFFLE: 2349
KFEAT:   O = enter_vaults
MAP
@..........@
....1131....
...1....1...
..1......1..
..2..O{..1..
..1..()..4..
..1......1..
...1....1...
....1911....
@..........@
ENDMAP

############################################################
# Vaults patterns I
#
NAME:    david_vaults_4
TAGS:    vaults_entry
MONS:    fire dragon / ice dragon / hydra / lindwurm
MONS:    freezing wraith / shadow wraith / wraith / phantasmal warrior
MONS:    deep troll / iron troll / rock troll / troll
MONS:    two-headed ogre / cyclops / ettin / hill giant
MONS:    necromancer / glowing shapeshifter / vault guard / wizard
MONS:    shapeshifter
NSUBST:  1 = 1:1 / 1:2 / 1:3. / 1 : 4 .:30 / 1:5 .:70
SHUFFLE: 12345
SUBST:   * = *.%, c : cvv, 6 = 6...
KFEAT:   O = enter_vaults
MAP
@..........@
.cccccccccc.
.c.11111..c.
.c.ccccc..c.
.c.c***c..c.
.c.+**Oc..c.
.ccccccc..c.
...666....c.
.cc...ccccc.
@..........@
ENDMAP

############################################################
# Vaults patterns II
#
NAME:   david_vaults_5
TAGS:   vaults_entry
KMONS:  O = vault guard
KFEAT:  O = enter_vaults
SUBST:  ! : !., ? : ?.
SUBST:  ?! = .:30 0:10 9:5 %:10 *:5
MAP
xxxxxxxxxxxxxx
xOx!x!x?x!x?xx
xx!x?x!x!x?x!x
x!x!x!x?x!x?xx
xx?x!x?x?x?x!x
x!x?x.x.x.x.xx
xx?x?x.x.x.x.x
x?x?x!x?x.x.xx
xx!x!x!x?x.x.x
xxxxxxxxxxxxx@
ENDMAP

############################################################
# The Guard of Blades
#
NAME:   erik_vaults_1
TAGS:   vaults_entry
MONS:   dancing weapon ; long sword good_item
SUBST:  v : vcxxx
KFEAT:  O = enter_vaults
MAP
.............
.............
.....v%v.....
....vvvvv....
.....1O1.....
....vvvvv....
.....v%v.....
.............
.............
ENDMAP

############################################################
# Above As Below
#
NAME:    erik_vaults_2
TAGS:    vaults_entry
MONS:    vault guard
SUBST:   v = vxx, b = bcc
KFEAT:   O = enter_vaults
MAP
vvvvvv.vvvvvv
vvvvvv.vvvvvv
vvvvbb.bbvvvv
vvvvb111bvvvv
.....1O1.....
vvvvb111bvvvv
vvvvbb.bbvvvv
vvvvvv.vvvvvv
vvvvvv.vvvvvv
ENDMAP

############################################################
# HangedMan's map
#
NAME:    hangedman_vaults_entry_quadrant_bands
TAGS:    vaults_entry no_monster_gen no_item_gen patrolling
ORIENT:  float
MONS:    centaur warrior, centaur / nothing w:5
MONS:    ogre mage, two-headed ogre / ogre w:16
MONS:    orc knight, orc priest / orc warrior / orc wizard / orc w:15
KMONS:   7 = yaktaur
KMONS:   8 = yaktaur / nothing w:5
KMONS:   9 = deep elf knight
KMONS:   0 = deep elf mage / deep elf priest / deep elf fighter / nothing w:15
KMONS:   A = boggart / kobold demonologist
KMONS:   B = big kobold / kobold w:5
KMONS:   C = skeletal warrior
KMONS:   D = skeleton
KMASK:   @` = !no_item_gen
KFEAT:   O = enter_vaults
SHUFFLE: 12 / 34 / 56 / 78 / 90 / AB / CD, O%*|
SUBST:   $ = $$., * = **%, | = **|., ` = .
MAP
vvvvvvv@@vvvvvvv
vO2...v``v...4*v
v2$v2vv``vv4v$4v
v.v1v.v``v.v3v.v
v.2vv.v``v.vv4.v
v.v....``....v.v
vvvvv.v``v.vvvvv
@``````````````@
@``````````````@
vvvvv.v``v.vvvvv
v.v....``....v.v
v.6vv.v``v.vv8.v
v.v5v.v``v.v7v.v
v6$v6vv``vv8v$8v
v%6...v``v...8|v
vvvvvvv@@vvvvvvv
ENDMAP

############################################################
# Tiered entry
#
NAME:   grunt_vaults_entry_tiered
TAGS:   vaults_entry no_monster_gen no_rtele_into transparent
MONS:   human w:29 / orc warrior w:1
MONS:   necromancer / wizard / yaktaur w:2
MONS:   vault guard w:29 / deep elf knight w:1
SUBST:  x : xcv
NSUBST: 2 = 1:2 / * = 12, 3 = 1:3 / * = 113
KFEAT:  O = enter_vaults
MAP
...............
.xxxxxxxxxxxxx.
.x%%...x...%%x.
.x%212.+.323%x.
.x.1T1.+..O2.x.
.x.1.1.+.323%x.
.x.....x...%%x.
.xx+++xxxxxxxx.
.x.....x...%%x.
.x.111.+....%x.
.x.2T..+.1T1.x.
.x%111.+.1.1.x.
.x%%...x.....x.
.xxxxxxxx+++xx.
.........@@@...
ENDMAP

############################################################
# A fortification!
#
NAME: grunt_vaults_entry_fortified
TAGS: vaults_entry no_pool_fixup no_monster_gen patrolling
ORIENT: north
MONS: human ; crossbow . bolt q:10 . short sword | dagger . \
              leather armour w:5 | ring mail | scale mail / \
      orc knight ; crossbow . bolt q:10 . short sword | dagger . \
                   leather armour w:5 | ring mail | scale mail / \
      deep elf knight / centaur warrior / yaktaur
MONS: vault guard / orc knight w:2
MONS: wizard / orc sorcerer / ogre mage
MONS: necromancer band / orc high priest band
NSUBST: T = 1:U / *:T
KFEAT: O = enter_vaults
MAP
xxxxxxxxxxxxxxxxxxx
xxxxxxxvvvvvxxxxxxx
xxxxxxxvT2Tvxxxxxxx
xxxxxxxv2O2vxxxxxxx
xxxxxxxvT.Tvxxxxxxx
xvvvvvvvv+vvvvvvvvx
xv*...3.....4...*vx
xv.1....2.2....1.vx
xv...............vx
xvv+vvvv.v.vvvv+vvx
xv...vxv.2.vxv...vx
xv...vxv...vxv...vx
xv...vxv1.1vxv...vx
xvv12vvv+++vvv21vvx
.wwwwwwW...Wwwwwww.
.WwwwwwW...WwwwwwW.
 .WwwwWW...WwwwwW.
  .WWWW.....WWWW.
   ......@......
ENDMAP

############################################################

NAME: lightli_vaults_fourway_checkpoint
TAGS: vaults_entry transparent
MONS: vault guard
KFEAT: O = enter_vaults
MAP
.................
...vv.......vv...
..vvvv.....vvvv..
.vvvvvv...vvvvvv.
.vvvvvvv+vvvvvvv.
..vvvv.....vvvv..
...vv.v0.0v.vv...
....v.0.1.0.v....
....+..1O1..+....
....v.0.1.0.v....
...vv.v0.0v.vv...
..vvvv.....vvvv..
.vvvvvvv+vvvvvvv.
.vvvvvv...vvvvvv.
..vvvv.....vvvv..
...vv.......vv...
.................
ENDMAP

###############################################################################
# Vaults:$ last level of the vaults -- dungeon.cc will change all these 'x's
###############################################################################
#
# This map traditionally allows controlled teleports. Even with the now
# random placement of the rune, this seems fine: some of the spots are
# awkward to reach via teleport, and there is now always a monster on the
# rune.
#
# Vaults:$ extensively uses subvaults. To provide another Vaults:$ quadrant
# variation, create a map tagged vaults_end_quadrant that is 27x23. It should
# have three blank cells on one corner (see any existing quadrant for an
# example), which will be used to orient that corner towards the middle of
# the map. Each quadrant must be capable of generating a rune, which
# should be done by placing an 'O' glyph and calling vaults_end_rune(_G).
#
# There is a lot of variance among the possible quadrants but we do ensure
# that (exactly) one quadrant with rich loot is generated. Those are tagged
# vaults_end_quadrant_prize and come in their own section below.

#############################################################
# The main vault for Vaults:$.
#
NAME:     vaults_vault
PLACE:    Vaults:$
ORIENT:   encompass
TAGS:     no_rotate no_dump
SHUFFLE:  ABCD
: if crawl.one_chance_in(36) then
SUBVAULT: A : vaults_end_quadrant_prize_mall
SUBVAULT: B : vaults_end_quadrant_mall
SUBVAULT: C : vaults_end_quadrant_mall
SUBVAULT: D : vaults_end_quadrant_mall
: else
SUBVAULT: A : vaults_end_quadrant_prize
SUBVAULT: B : vaults_end_quadrant
SUBVAULT: C : vaults_end_quadrant
SUBVAULT: D : vaults_end_quadrant
:end
SUBST:    ABCD = .
MONS: vault guard
{{
  set_feature_name("metal_wall", "heavily etched metal wall")
  set_feature_name("green_crystal_wall", "heavily etched wall of green crystal")
}}
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxx..............................................................xxxx
xxxx..............................................................xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA....BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAAA.11.BBBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAAA.1111.BBBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx..AAAAAAAAAAAAAAAAAAAAAAAAA.1....1.BBBBBBBBBBBBBBBBBBBBBBBBB..xxxx
xxxx...........................1..(<..1...........................xxxx
xxxx..........................11.[..{.11..........................xxxx
xxxx...........................1..<<..1...........................xxxx
xxxx............................1....1............................xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCC..1111..DDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCC..11..DDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..CCCCCCCCCCCCCCCCCCCCCCCCCCC....DDDDDDDDDDDDDDDDDDDDDDDDDDD..xxxx
xxxx..............................................................xxxx
xxxx..............................................................xxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP


############################################################
# Vaults:$ - the subvault used to place the rune.
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:  vaults_end_rune
TAGS:  vaults_end_rune
KMONS: O = 8 / 9
KITEM: O = silver rune of Zot
MAP
O
ENDMAP

############################################################
# Vaults:$ - the subvault used for potential rune locations that do not
# contain the real rune.
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:  vaults_end_norune
TAGS:  vaults_end_norune allow_dup
KMONS: o = 8 / 9
: if crawl.random2(13) == 12 then
KFEAT:   o = any shop
: else
KITEM:   o = any good_item
: end
MAP
o
ENDMAP

############################################################
# Vaults:$ - the subvault used for potential rune locations that do not
# contain the rune, but rather a mimic of it!
#
# Used by the 'vaults_end_rune()' function in the prelude.
#
NAME:    vaults_end_rune_mimic
TAGS:    vaults_end_norune
WEIGHT:  1
KITEM:   o = silver rune of Zot mimic
MAP
o
ENDMAP

###############################################################################
# Vaults:$ quadrants
###############################################################################

############################################################
# about 2 |
NAME: vaults_end_classical_cross
TAGS: vaults_end_quadrant
NSUBST:  U = 1:. / *:xxxx.
NSUBST:  V = 1:. / *:xxxx.
SUBST:   - = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxx.................xxxxx
xxx.......-.....-.......xxx
xxx...-.............-...xxx
xx.......................xx
xx.-....xxxxxxxxxxx....-.xx
xx......x.........x......xx
xx....xxU.........Uxx....xx
xx..-.x....xxxxx....x....xx
xx....x.-.Vx$$$xx...x.-..xx
xx....x..xx$***$xx..x....xx
xx.-..x..x$$*O*$$x-.x....xx
xx....x..xx$***$xx..x....xx
xx....x...Vx$$$xV...x..-.xx
xx..-.xxx-.xxxxx..Uxx....xx
xx......x.........x......xx
xx......xxxxxxxxxxx.-....xx
xxx...-.................xxx
xxx........-....-.......xxx
....xx................xxxxx
 ...xxxxxxxxxxxxxxxxxxxxxxx
  ..xxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 4 |
NAME:    vaults_end_classical_diamond
TAGS:    vaults_end_quadrant
SHUFFLE: !_
SUBST:   ! = | * .:20
SUBST:   _ = 8 9 .:20
SUBST:   a : x .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxx.a
xx!x.x.x!x.x.x.x.x.x.x.x.a
x.x.x.x.x.x.x.x!x.x.x_x.x.a
xx.x!x.x.x.x.x.x.x.x!x.x.x.
x.x.x.x.x_x.x.x_x.x.x.x.x.x
xx.x.x.x.x.x.x.x.x.x.x.x_xx
x.x.x!x.x.x.x.x.x.x!x.x.x.x
xx.x_x.x.x!x.x.x.x.x.x.x.xx
x.x.x.x.x_x.x.x.x.x.x.x.x.x
xx.x.x.x.x.x.x.x.x.x.x.x!xx
x_x.x!x.x.x.x.x.x!x.x_x.x.x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x.x.x_x.x.x.x.x.x.x.x.x_x.x
xx.x.x.x.x.x.x_x.x.x.x.x.xx
x!x.x.x.x!x.x.x.x.x.x.x.x.x
xx.x.x.x.x.x.x!x.x.x.x.x.xx
x.x.x.x.x.x.x.x.x.x_x.x.x.x
xx.x_x.x.x.x.x.x.x.x.x.x_xx
x.x!x.x.x.x.x.x.x!x.x.x.x.x
xx.x.x.x.x.x.x_x.x.x.x.x.xx
x.x.x.x.x.x_x.x.x.x.x.x.x.x
xO.x.x_x.x.x!x.x.x.x.x!x_xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 5 |
NAME: vaults_end_classical_stripes
TAGS: vaults_end_quadrant
# double use of Y=Y. and Z=Z. for decreasing variance
SUBST:   Y = Y ., Z = Z .
SUBST:   Y = Y ., Z = Z .
SUBST:   Y = 9:30 8:10 .:40
SUBST:   Z = 9:10 8:30 .:40
SUBST:   a : x .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  axaxxaaxaxxxxxxxxxxxxxxxx
 .......................??x
a................Y..Z...??x
x..Y..Y..Y..Y..Y..Z..Y..Y.x
a...Y..Y..Y..Z..Y..Y..Z...x
x.Y..Y..Y..Y..Z..Y..Z..Y..x
x..Y..Y..Z..Z..Y..Y..Y..Z.x
a...Y..Z..Y..Y..Z..Y..Y...x
a.Y..Y..Z..Z..Y..Y..Y..Z..x
x..Z..Y..Y..Y..Z..Y..Y..Y.x
x...Y..Y..Z..Y..Z..Z..Y...x
x.Z..Z..Y..Y..Z..Y..Z..Z..x
x..Y..Z..Y..Z..Z..Y..Z..Z.x
x...Z..Z..Z..Y..Z..Z..Y...x
x.Y..Z..Y..Z..Z..Z..Z..Z..x
x..Z..Y..Z..Y.............x
x...Y..Z..Z..Z...ZZZZZZZZ.x
x....Z..Y..Z..Y..Z........x
x..Z..Z..Y..Z....Z..??????x
x...Z..Y..Z..Z...Z..??????x
x??..Y..Z..Z..Z..Z..??????x
x??.................?????Ox
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 4 |
NAME:   vaults_end_mu_clover
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: ? = 1:O / *:*
NSUBST: " = 1:. / *:x
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxxxx
 .........................x
x.........................x
x..xxxxxxxxx999xxxxxxxxx..x
x..x?**....x...x....**?x..x
x..x**..9..x...x..9..**x..x
x..x*..9...x...x...9..*x..x
x..x..9....xx"xx....9..x..x
x..x...................x..x
x..xxxxxxxx.....xxxxxxxx..x
x..9......x.....x......9..x
x..9......"....."......9..x
x..9......x.....x......9..x
x..xxxxxxxx.....xxxxxxxx..x
x..x...................x..x
x..x..9....xx"xx....9..x..x
x..x*..9...x...x...9..*x..x
x..x**..9..x...x..9..**x..x
x..x?**....x...x....**?x..x
x..xxxxxxxxx999xxxxxxxxx..x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 8 |
NAME:   vaults_end_mu_not_diamond
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 *:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xx.x9x.x.x.x.x.x.x.x.x.x..
x.x.x.x.x.x.x.x.x.x.x.x9x.x
xx.x.x.x.x9x.x.x9x.x.x.x.xx
x.x.xxxxxxxxx.xxxxxxxxx.x.x
xx9xxxxxxxxx.x.xxxxxxxxx.xx
x.x.xxxxxxxx...xxxxxxxx.x.x
xx.xxxxxxx...9...xxxxxxx9xx
x.x.xxxxx.........xxxxx.x.x
xx.xxxxx...|$|$|...xxxxx.xx
x9x.x.x....$***$....x.x.x.x
xx.x.x.x.9.|*O*|.9.x.x.x.xx
x.x.x.x....$***$....x.x.x9x
xx.xxxxx...|$|$|...xxxxx.xx
x.x.xxxxx.........xxxxx.x.x
xx.xxxxxxx...9...xxxxxxx.xx
x.x.xxxxxxxx...xxxxxxxx.x.x
xx9xxxxxxxxx.x.xxxxxxxxx9xx
x.x.xxxxxxxxx.xxxxxxxxx.x.x
xx.x.x.x.x9x.x.x9x.x.x.x.xx
x.x.x.x.x.x.x.x.x.x.x.x.x.x
xx.x9x.x.x.x.x.x.x.x.x9x.xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 11 |
NAME:    vaults_end_mu_boxes
TAGS:    vaults_end_quadrant
NSUBST:  a = 1:+ / *:x
NSUBST:  b = 1:+ / *:x
NSUBST:  c = 1:+ / *:x
NSUBST:  d = 1:+ / *:x
NSUBST:  e = 1:+ / *:x
NSUBST:  f = 1:+ / *:x
NSUBST:  g = 1:+ / *:x
SHUFFLE: ABCDEFG
SUBST:   ABC = 9
SUBST:   D = |*$9
SUBST:   E = |
SUBST:   F = *
NSUBST:  G = 1:O / *:9
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x.........................x
x..........xxbxx..........x
x..........xBBBx..........x
x..xxaxx...bBBBb...xxcxx..x
x..xAAAx...xBBBx...xCCCx..x
x..aAAAa...xxbxx...cCCCc..x
x..xAAAx...........xCCCx..x
x..xxaxx...........xxcxx..x
x..........xxdxx..........x
x..........xDDDx..........x
x....9.....dDDDd.....9....x
x..........xDDDx..........x
x..........xxdxx..........x
x..xxfxx...........xxgxx..x
x..xFFFx...........xGGGx..x
x..fFFFf...xxexx...gGGGg..x
x..xFFFx...xEEEx...xGGGx..x
x..xxfxx...eEEEe...xxgxx..x
x..........xEEEx..........x
x..........xxexx..........x
 .........................x
  xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 8 |
NAME:   vaults_end_mu_long
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:10
NSUBST: $ = 1:O / *:$
SUBST:  $ = |**$
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxa
x.........................
x.........................a
x.........................x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
x..x$$$............999....x
x..x$$$............999....x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
x..x$$$............999....x
x..x$$$............999....x
x..xxxxxxxxxxxxxxxxxxxxx..x
x....999............$$$x..x
x....999............$$$x..x
x..xxxxxxxxxxxxxxxxxxxxx..x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 19 *, 14 monsters
NAME:   vaults_end_minmay_circular_pillars
TAGS:   vaults_end_quadrant
NSUBST: a = 1:+ / *:x, b = 1:+ / *:x, c = 1:+ / *:x, d = 1:+ / *:x
NSUBST: O = 1:O / *:*
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxx9..9xxxx9...9xxxx9.....
xx......xx.......xx.......x
x9..xx......xbx......xx...x
x..xxxx....xx*xx....xxxx..x
x..xxxx....b*O*b....xxxx..x
x9..xx9....xx*xx....9xx..9x
xx..........xbx..........xx
xxx.....................xxx
xxx..xax...9...9...xcx..xxx
xx..xx*xx.........xx*xx..xx
x9..a*O*a.........c*O*c..9x
xx..xx*xx.........xx*xx..xx
xxx..xax...9...9...xcx..xxx
xxx.....................xxx
xx..........xdx..........xx
x9..xx9....xx*xx....9xx..9x
x..xxxx....d*O*d....xxxx..x
x..xxxx....xx*xx....xxxx..x
x9..xx......xdx......xx..9x
xx......xx.......xx......xx
xxx9..9xxxx9...9xxxx9..9xxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 12 monsters
NAME:   vaults_end_minmay_hexagonal
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxx9............9.....
xxxxxx....................x
xxxxx...xxxxx.xxxxx.......x
xxxx...xx9.......9xx......x
xxxx..xx...........xx.....x
xxx...x...xxx.xxx...x.....x
xx...xx..xx9...9xx..xx....x
xx..xx...x.......x...xx...x
x9..x9..xx..***..xx..9x..9x
x..xx..xx9.*****.9xx..xx..x
x..........**O**..........x
x..xx..xx9.*****.9xx..xx..x
x9..x9..xx..***..xx..9x..9x
xx..xx...x.......x...xx..xx
xx...xx..xx9...9xx..xx...xx
xxx...x...xxx.xxx...x...xxx
xxxx..xx...........xx..xxxx
xxxx...xx9.......9xx...xxxx
xxxxx...xxxxx.xxxxx...xxxxx
xxxxxx...............xxxxxx
xxxxxxx9...........9xxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 15 *, 10 monsters
NAME:  vaults_end_minmay_subdivision
TAGS:  vaults_end_quadrant
SUBST: 9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x*....x....*xxx*....x.....
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x....9x9....xxx....9x9....x
xxxxxx.xxxxx...xxxxx.xxxxxx
x....9x9....xxx....9x9....x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x*....x....*xxx*....x....*x
xxxxxx.xxxxx9.9xxxxx.xxxxxx
xxxxxx.xxxxx.O.xxxxx.xxxxxx
xxxxxx.xxxxx9.9xxxxx.xxxxxx
x*....x....*xxx*....x....*x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x....9x9....xxx....9x9....x
xxxxxx.xxxxx...xxxxx.xxxxxx
x....9x9....xxx....9x9....x
x.....x.....xxx.....x.....x
x.....x.....xxx.....x.....x
x*....x....*xxx*....x....*x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 8 monsters
NAME:   vaults_end_minmay_triangle_fans
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxx.....9xxxx.....9xxxx.
xxxx..x....xxx..x....xxx..x
xxx...xx...xx...xx...xx...x
xx....xxx..x....xxx..x....x
x....9xxxx.....9xxxx......x
x.xxxx9.....xxxx9.....xxxxx
x..xxx....x..xxx....x..xxxx
x...xx...xx...xx...xx...xxx
x....x..xxx....x..xxx....xx
x......xxxx9.....xxxx9....x
x.........................x
xxxxx.....9xxxx.....9xxxx.x
xxxx..x....xxx..x....xxx..x
xxx...xx...xx...xx...xx...x
xx....xxx..x....xxx..x....x
x....9xxxx.....9xxxx......x
x*xxxx9.....xxxx9.....xxxxx
x**xxx....x..xxx....x..xxxx
x***xx...xx...xx...xx...xxx
x****x..xxx....x..xxx....xx
xO****.xxxx9.....xxxx9....x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 11 monsters
NAME:   vaults_end_minmay_pillar_box
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x.........................x
x.x.x.x.x.x.x.x.x.x.x.x.x.x
x.........................x
x.x.xx9xx..xx9xx..xx9xx.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.9.|....9.|.9....|.9.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.xx.xx..xx.xx..xx.xx.x.x
x...9...9..xx.xx..9...9...x
x.x.xx.xx..x...x..xx.xx.x.x
x...xx|xx..x.O.x..xx|xx...x
x.x.xx.xx..x...x..xx.xx.x.x
x...9...9..xx.xx..9...9...x
x.x.xx.xx..xx.xx..xx.xx.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.9.|....9.|.9....|.9.x.x
x...xx.xx..xx.xx..xx.xx...x
x.x.xx9xx..xx9xx..xx9xx.x.x
x.........................x
x.x.x.x.x.x.x.x.x.x.x.x.x.x
x.........................
xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 15 monsters
NAME:   vaults_end_minmay_partial_spiral
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x.........................x
x.........................x
x..x99xxxxxxxxxxxxxxxxxx..x
x..x................9..9..x
x..x................9..9..x
x..x99x99xxxxxxxxxxxx..x..x
x..x..x..........9..9..x..x
x..x..x..........9..9..x..x
x..x..x99xxxxxxxxx..x..x..x
x..x..x..x*******x..x..x..x
x..x..x..+***O***x..x..x..x
x..x..x..x*******x..x..x..x
x..x..xxxxxxxxxxxx99x..x..x
x..9..9.............x..x..x
x..9..9.............x..x..x
x..xxxxxxxxxxxxxxx99x99x..x
x..9...................x..x
x..9...................x..x
x..xxxxxxxxxxxxxxxxxx99x..x
x.........................x
x.........................
xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 2 |, 18 *, 16 monsters
NAME:   vaults_end_minmay_grid2
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xO.xx**xx**xx**xx**xx**xxOx
xxx..xx..xx..xx..xx..xx..xx
xxx.9xx9.xx..xx..xx.9xx9.xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx.9xx9.xx..xx..xx.9xx9.xx
xxx..xx.9xx9.xx.9xx9.xx..xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx..xx.9xx9.xx.9xx9.xx..xx
xxx..xx.9xx9.xx.9xx9.xx..xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx..xx.9xx9.xx.9xx9.xx..xx
xxx.9xx9.xx..xx..xx.9xx9.xx
x..xx..xx..xx..xx..xx..xx*x
x..xx..xx..xx..xx..xx..xx*x
xxx.9xx9.xx..xx..xx.9xx9.xx
xxx..xx..xx..xx..xx..xx..xx
x..xx..xx..xx..xx..xx..xx.x
 ..xx..xx..xx..xx..xx..xxOx
  xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 2 |, 15 *, 14 monsters
NAME:   vaults_end_minmay_pluses
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.....x......x......x.....
x.........................x
x.........................x
x.....x......x......x.....x
xx...xxx9999xxx9999xxx...xx
x.....x......x......x.....x
x.....9......x......9.....x
x.....9.....*x......9.....x
x.....9....**x......9.....x
x.....x...**Ox......x.....x
xx...xxxxxxxxxxxxxxxxx...xx
x.....x...**OxO**...x.....x
x.....9....**x**....9.....x
x.....9.....*x*.....9.....x
x.....9......x......9.....x
x.....x......x......x.....x
xx...xxx9999xxx9999xxx...xx
x.....x......x......x.....x
x.........................x
x.........................x
x.....x......x......x.....x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 9 monsters
NAME:   vaults_end_minmay_broken_diamonds
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x..xx....9xx...xx9....xx..
x........xx.....xx........x
xx......xx...x...xx......xx
xxx....xx....xx...xx....xxx
x9xx...x......xx...x...xx9x
x..xx..........xx.....xx..x
x...xx...xx....9xx........x
x.........xx..9xx...x....xx
x......x...xx9xx...xxx...xx
xx....xxx...xxx...xx9xx...x
xx...xx9xx...x...xx9..xx..x
x...xx..9xx.......xx......x
x..xx....9xx...x...xx....xx
x9.......xx....xx...x...xxx
xx......xx......xx.....xx9x
xxx....xx...xx..9xx...xx..x
x*xx...x.....xx9xx........x
x**xx.....x...xxx...x....xx
x***xx...xx....x....xx...xx
x****...xx...........xx...x
xO****.xx9..xx...xx..9xx..x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 17 *, 10 monsters
NAME:   vaults_end_minmay_smooth_crossroads
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9...*Ox9.....9x9........9
x....**x.......x...x......x
x....*xx...x...x...xx.....x
x....*x....x...x....x.....x
x....xx....x...x....xx....x
x..xxx....xx...xx....xxx..x
x.xx......x.....x......xxxx
x........xx.....xx.......9x
x9.....xxx.......xxx......x
xxxxxxxx.....9.....xxxx...x
x9..........9x9..........9x
x...xxxx.....9.....xxxxxxxx
x......xxx.......xxx.....9x
x9.......xx.....xx........x
xxxx......x.....x......xx.x
xO*xxx....xx...xx....xxx..x
x****xx....x...x....xx....x
x.....x....x...x....x*....x
x.....xx...x...x...xx*....x
x......x...x.......x**....x
x9........9x9.....9xO*...9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 10 monsters
NAME:   vaults_end_minmay_diagonal_split
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9xxx9.......x9...........
x..xxx...xx...x...........x
x...xxx..9xx...x..........x
x....xxx...xx...x9........x
x.x9..xxx...xx...x........x
x.xx...xxx...xx...x.......x
x..xx...xxx...xx...x......x
x...xx...xxx...xx...x.....x
xx...xx...xxx...xx...x9...x
x9x...xx...xxx9..xx...x...x
x..x...xx...9.9...xx...x..x
x...x...xx..9xxx...xx...x9x
x...9x...xx...xxx...xx...xx
x.....x...xx...xxx...xx...x
x......x...xx...xxx...xx..x
x.......x...xx...xxx...xx.x
x*.......x...xx...xxx..9x.x
x**......9x...xx...xxx....x
x***.......x...xx9..xxx...x
x****.......x...xx...xxx..x
xO****......9x.......9xxx9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 82 $, 16 monsters
NAME:    vaults_end_minmay_loops
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall
SHUFFLE: ae / bf / cg / dh
SUBST:   a = +, e = ., bcdfgh = x
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxx$$$$$$$$$xxxxx...
xxx....xxx$$$$$$$xxx......x
xx.9xx9.xxx$$$$$xxx.9xx9.xx
xx.xxxx.xxxx$$$xxxx.xxxx.xx
xx.xxxx.xxxxx$xxxxx.xxxx.xx
xx.9xx9..xxxx+xxxx..9xx9.xx
xxx......9xx9.9xx9......xxx
x$xxxx9.............9xxxx$x
x$$xxxx....9xax9....xxxx$$x
x$$$xxx....xxexx....xxx$$$x
x$$$$+.....dhOfb.....+$$$$x
x$$$xxx....xxgxx....xxx$$$x
x$$xxxx....9xcx9....xxxx$$x
x$xxxx9.............9xxxx$x
xxx......9xx9.9xx9......xxx
xx.9xx9..xxxx+xxxx..9xx9.xx
xx.xxxx.xxxxx$xxxxx.xxxx.xx
xx.xxxx.xxxx$$$xxxx.xxxx.xx
xx.9xx9.xxx$$$$$xxx.9xx9.xx
xxx....xxx$$$$$$$xxx....xxx
xxxxxxxxx$$$$$$$$$xxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# One shop, 16 monsters
NAME:    vaults_end_dpeg_shops1
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall
KFEAT:   S = any shop
: if crawl.one_chance_in(4) then
SUBST:   A = +, a = ., CD = x
: else
SHUFFLE: CD
SUBST:   C = ., DAa = x
: end
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxx.....xxxx....
xxxxxxxxx.................x
xxxxx.....................x
xxxx.....................xx
xxxx.....................xx
xxx......................xx
xxx.......xxxxxxx........xx
xx.......xxxxxxxxx.......xx
xx......xxx.999.xxx.......x
xx......xC.9$$$9.xx.......x
x.......CC.9$S$9.xx.......x
x.......xC.9$$$9.xx......xx
x.......xAa.999.xxx......xx
xx.......xAxDDDxxx.......xx
xx........xxxDxxx.......xxx
xx......................xxx
xx9....................xxxx
xx$9...................xxxx
xx$O9.................xxxxx
xxx$$9............xxxxxxxxx
xxxxxxxxx.....xxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Consumable shops (scrolls, potions, food).
# Monsters in rooms.
NAME:    vaults_end_dpeg_shops2
TAGS:    vaults_end_quadrant vaults_end_quadrant_mall
NSUBST:  A = 1:+ / *:x+
NSUBST:  B = 1:+ / *:x+
NSUBST:  C = 1:+ / *:x+
NSUBST:  S = 3:S / 1:O / *:S99
KFEAT:   S = scroll shop / distillery shop / food shop
NSUBST:  ' = 20:9 / *:.
NSUBST:  . = 5:9 / *:.
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.........................x
x...xxxxx..xxxxx..xxxxx...x
x...x'S'x..x'S'x..x'S'x...x
x...x'''x..x'''x..x'''x...x
x...xx+xx..xx+xx..xx+xx...x
x.........................x
x.........................x
x...xxAxx..xxBxx..xxCxx...x
x...x'''x..x'''x..x'''x...x
x...x'S'x..x'S'x..x'S'x...x
x...x'''x..x'''x..x'''x...x
x...xxAxx..xxBxx..xxCxx...x
x.........................x
x.........................x
x...xx+xx..xx+xx..xx+xx...x
x...x'''x..x'''x..x'''x...x
x...x'S'x..x'S'x..x'S'x...x
x...xxxxx..xxxxx..xxxxx...x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 20 monsters
NAME:   vaults_end_minmay_plus_grid
TAGS:   vaults_end_quadrant
NSUBST: * = 1:O / *:*
SUBST:  * = 9 8 *:20 .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxx.x.*.x.xxx.x.*.x.xxx..
x.x.*.x.xxx.x.*.x.xxx.x...x
x*.x.xxx.x.*.x.xxx.x.*.x.xx
x.xxx.x.*.x.xxx.x.*.x.xxx.x
xx.x.*.x.xxx.x.*.x.xxx.x.*x
x.*.x.xxx.x.*.x.xxx.x.*.x.x
xx.xxx.x.*.x.xxx.x.*.x.xxxx
xxx.x.*.x.xxx.x.*.x.xxx.x.x
xx.*.x.xxx.x.*.x.xxx.x.*.xx
x.x.xxx.x.*.x.xxx.x.*.x.xxx
xxxx.x.*.x.xxx.x.*.x.xxx.xx
x.x.*.x.xxx.x.*.x.xxx.x.*.x
x*.x.xxx.x.*.x.xxx.x.*.x.xx
x.xxx.x.*.x.xxx.x.*.x.xxx.x
xx.x.*.x.xxx.x.*.x.xxx.x.*x
x.*.x.xxx.x.*.x.xxx.x.*.x.x
xx.xxx.x.*.x.xxx.x.*.x.xxxx
xxx.x.*.x.xxx.x.*.x.xxx.x.x
xx.*.x.xxx.x.*.x.xxx.x.*.xx
x.x.xxx.x.*.x.xxx.x.*.x.xxx
xxxx.x.*.x.xxx.x.*.x.xxx.xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 *, 12 monsters
NAME:   vaults_end_minmay_curved1
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.................xxxxxx..
x.xxxx....xxxx.......xx...x
x...9xxx....9xxx.........xx
x.....9xx.....9xx.......xxx
x......9x......9x.......xxx
x.......xx......xx.......xx
x.......9x......9x.......xx
x........x.......x9......xx
x.xxxx...xxxxx.**xx.......x
x...9xxx..xxxxxxO*x9......x
x.....9xx*xxxxxxx*xx9.....x
x......9x*Oxxxxxx..xxx9...x
x.......xx**.xxxxx...xxxx.x
xx......9x.......x........x
xx.......x9......x9.......x
xx.......xx......xx.......x
xxx*......x9......x9......x
xxx*O.....xx9.....xx9.....x
xxxx**.....xxx9....xxx9...x
xxxxxx.......xxxx....xxxx.x
xxxxxxxxx.................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 18 *, 20 monsters
NAME:   vaults_end_minmay_broken_lines
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.9.x.x.x.x.x.x.x.9.x.x...
x*x.x.x.x.x.x.x.x.x.x.x...x
x*x.x.x.9.x.9.x.x.x.9.x.x.x
x*x.9.x.x.x.x.x.x.x.x.x.x.x
x*x.x.x.x.9.x.x.9.x.x.9.x.x
x*x.x.9.x.x.x.x.x.x.x.x.x.x
x*x.x.x.x.x.x.9.x.x.x.9.x.x
x*x.x.x.9.x.x.x.x.9.9.x.x.x
x*x.x.x.x.x.9.x.x.x.x.x.x.x
x*x.x.x.x.x.x.x.x.x.x.x.9.x
xOx.x.x.x.x.x.9.x.x.x.x.x.x
x*x.9.x.x.9.x.x.x.9.x.x.x.x
x*x.x.x.x.x.x.x.x.x.x.9.x.x
x*x.x.x.9.x.x.9.x.x.x.x.x.x
x*x.x.x.x.x.x.x.x.x.x.x.9.x
x*x.x.9.x.9.x.x.9.x.9.x.x.x
x*x.9.x.x.x.9.x.x.x.x.9.x.x
x*x.x.x.x.x.x.9.x.x.x.x.x.x
x*x.x.9.x.x.x.x.x.x.x.x.x.x
x*x.x.x.x.x.x.x.x.9.x.x.9.x
x.9.x.x.x.9.9.x.x.x.9.x.x.x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 12 monsters
NAME:    vaults_end_minmay_surrounding_squares
TAGS:    vaults_end_quadrant
SHUFFLE: AB
SUBST:   9 = 8 9 .:20
SUBST:   A = ., B = x
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9.......................9
x.9xx.xxx.xxx.xxx.xxx.xx9.x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.........................x
x.xxx.9xxxxxxAxxxxxx9.xxx.x
x.xxx.xx...........xx.xxx.x
x.xxx.x.9xxxxBxxxx9.x.xxx.x
x.....x.xx9.....9xx.x.....x
x.xxx.x.x9.*****.9x.x.xxx.x
x.xxx.B.A.***O***.A.B.xxx.x
x.xxx.x.x9.*****.9x.x.xxx.x
x.....x.xx9.....9xx.x.....x
x.xxx.x.9xxxxBxxxx9.x.xxx.x
x.xxx.xx...........xx.xxx.x
x.xxx.9xxxxxxAxxxxxx9.xxx.x
x.........................x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.xxx.xxx.xxx.xxx.xxx.xxx.x
x.9xx.xxx.xxx.xxx.xxx.xx9.x
x9.......................9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 4 |, 15 *, 18 monsters
NAME:   vaults_end_minmay_split_center
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.........................x
x..xxxx999xxxxxxx999xxxx..x
x..9..xxx..xxOxx..xxx..9..x
x..9....xx..x*x..xx....9..x
x..xxxx..xx.x*x.xx..xxxx..x
x..9..xx..x|x*x|x..xx..9..x
x..xx..xx.xxx*xxx.xx..xx..x
x..9xx..x..xx*xx..x..xx9..x
x..9....xx.xx*xx.xx....9..x
x..xxxx....xx*xx....xxxx..x
x..9..xxx...x*x...xxx..9..x
x..9....xx..x*x..xx....9..x
x..xxxx..xx.x*x.xx..xxxx..x
x..9..xx..x|x*x|x..xx..9..x
x..xx..xx.xxx*xxx.xx..xx..x
x..9xx..x..xx*xx..x..xx9..x
x..9.xx.x..xx*xx..x.xx.9..x
x..x99x9x99xx*xx99x9x99x..x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 12 monsters
NAME:   vaults_end_minmay_sharp_edges
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxx9xxx9xxx9xxx9xxx9xxx..
xxx...x...x...x...x...x...x
xx.......................xx
x9....x.................xxx
xx...xxx.................xx
xxx.xxxxx..x......x......9x
xx...xxx..xxx....xxx.....xx
x9....x..xxOxx..xxxxx...xxx
xx......xxO**xx..xxx.....xx
xxx......xx***xx..x......9x
xx........x9***xx........xx
x9......x..99***xx......xxx
xx.....xxx..99**Oxx......xx
xxx...xxxxx..xxOxx..x....9x
xx.....xxx....xxx..xxx...xx
x9......x......x..xxxxx.xxx
xx.................xxx...xx
xxx.................x....9x
xx.......................xx
x...x...x...x...x...x...xxx
x9.xxx9xxx9xxx9xxx9xxx9xxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 20 *, 14 monsters
NAME:   vaults_end_minmay_outlined_triangles
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x...x.x.x..x.x.x..x.x.x...x
x....9.9....9.9....9.9....x
x...x.x.....x.x.....x.x...x
x....9.......9.......9....x
x...x........x........x...x
x.........................x
x.........xxx9xxx.........x
x...x.....xx***xx.....x...x
x....9x...x*****x...x9....x
x...x..9x.9**O**9.x9..x...x
x....9x...x*****x...x9....x
x...x.....xx***xx.....x...x
x.........xxx9xxx.........x
x.........................x
x...x........x........x...x
x....9.......9.......9....x
x...x.x.....x.x.....x.x...x
x....9.9....9.9....9.9....x
x...x.x.x..x.x.x..x.x.x...x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 12 *, 11 monsters
NAME:   vaults_end_minmay_oval
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.........................x
x..xxxxxxxxxx......xxxxx..x
x..xxxxxxx9..........xxx..x
x..xxxxx9.............xx..x
x..xxxx9...............x..x
x..xxx9................x..x
x..xx9..........9xx.......x
x..xx.........9xxxx.......x
x..x9......9xxxxxx9....x..x
x..x.....9xxxxxxx9.....x..x
x..x....9xxxxxx9......9x..x
x.......xxxx9.........xx..x
x.......xx9..........9xx..x
x..x****............9xxx..x
x..x****...........9xxxx..x
x..xxO**..........9xxxxx..x
x..xxx**........9xxxxxxx..x
x..xxxxx......xxxxxxxxxx..x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 12 *, 12 monsters
NAME:   vaults_end_minmay_fences
TAGS:   vaults_end_quadrant
NSUBST: A = 1:+ / *:x, B = 1:+ / *:x
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.........................x
x..xxx..x.x.x9x.x.x..xxx..x
x..x9.................9x..x
x..x...................x..x
x.......x.x.x9x.x.x.......x
x......9x.........x9......x
x..x..xxx.........xxx..x..x
x..........xxAxx..........x
x..x..x....x.9.x....x..x..x
x..9..9....A9O9A....9..9..x
x..x..x....x.9.x....x..x..x
x..........xxAxx..........x
x..x..xxx.........xxx..x..x
x......9x.........x9......x
x99.....x.x.x9x.x.x.......x
xBBx...................x..x
x**B9.................9x..x
x**xBx..x.x.x9x.x.x..xxx..x
x****B9...................x
x****B9...................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 17 *, 2 |, 14 monsters
NAME:   vaults_end_minmay_wings
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9........................
x9........................x
xxxxx9999xx.....xx9999xxxxx
x**xx....xx.....xx....xx**x
x***xx....xx...xx....xx***x
x...xx....xx...xx....xx...x
x....xx....xx.xx....xx....x
x....xx....xx.xx....xx....x
x.....xx....x.x....xx.....x
x.....xx....x.x....xx.....x
x.....Oxx...9.9...xxO.....x
x.....xx....xxx....xx.....x
x.....xx....xxx....xx.....x
x....xx....xxOxx....xx....x
x....xx....xx*xx....xx....x
x...xx....xx***xx....xx...x
x...xx....xx***xx....xx...x
x..xx....xx.....xx....xx..x
x99xx9999xx.....xx9999xx99x
x........9.......9........x
x........9.......9........x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 1 |, 13 monsters
NAME:   vaults_end_minmay_cones
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.xx........xx.......xx...x
x......xx...9....xx...9...x
x..xx..9.....xx.....xx.9x.x
x........xx..9...xx.9.x.x.x
x....xx.......xx.....9x...x
xxx...9....xx.9..xx.......x
x.......xx.....xx9.x.x.x..x
x....xx.9....xx...9x.x.x..x
x.xx.......xx9....x.......x
x........xx...xx..x.x.....x
x......xx9...xxx.x.9x.x...x
x....xx.....xxx.9x...9x.x.x
x..xx9....9xxx..x..x...9x.x
xxx.......xxx...x..x......x
x.......9xxx9..x.....x....x
x.......xxx...9x..x..x....x
x*.....xxx9...x..9x....x..x
x**...xxx*....x.......9x..x
x***.xxx***..x...x.9x.....x
xO**xxxO****9x...x..x.....x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 19 *, 12 monsters
NAME:   vaults_end_grunt_pinched
TAGS:   vaults_end_quadrant
NSUBST: O = 1:O / *:*
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x......*Ox................
x......*xx...9............x
x...9...xx...x............x
x......xx....xx....9......x
x.....xx9.....x...........x
x...xxxxx.....xx..........x
x9xxxx.xxx.....xx......9..x
x.......xx..9.9xxxx.......x
x...9....9....xx.9xxx.....x
x.9.x........xx....xxxx...x
x...xxxx....xx........x.9.x
x.....xxx.9xx.....9.......x
x.....*Oxxxx..............x
x..9..**xxx9..............x
x......xxxxx...9.xx..9.xx9x
x.....xx.*Oxx....xxxxxxxx.x
x....xx..**.x.....xxxx....x
x...xx......xx....xx......x
x**xx....9...x.9..x....9..x
xOxx*........9...xx*......x
xxxO*............xO*......x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 18 *, 12 monsters
NAME:    vaults_end_grunt_door_to_door
TAGS:    vaults_end_quadrant
SHUFFLE: 456
NSUBST:  1 = 1:9 / *:*
NSUBST:  2 = 1:9 / *:*
NSUBST:  3 = 1:9 / *:*
NSUBST:  4 = 1:9 / *:*
NSUBST:  5 = 1:9 / *:*
NSUBST:  6 = 1:O / *:*
SUBST:   9 = 8 9 .:30
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxx+
xx..........xxx..........xx
x.9..+xx+..9.+.9..+xx+..9.x
x....x11x....x....x22x....x
x....x11x....x....x22x....x
x.9..+xx+..9.+.9..+xx+..9.x
xx..........xxx..........xx
xx+xx+xx+xx+xxx+xx+xx+xx+xx
xx..........xxx..........xx
x.9..+xx+..9.x.9..+xx+..9.x
x....x44x....x....x33x....x
x....x44x....x....x33x....x
x.9..+xx+..9.+.9..+xx+..9.x
xx..........xxx..........xx
xx+xx+xx+xx+xxx+xx+xx+xx+xx
xx..........xxx..........xx
x.9..+xx+..9.+.9..+xx+..9.x
x....x55x....x....x66x....x
x....x55x....x....x66x....x
x.9..+xx+..9.+.9..+xx+..9.x
xx..........xxx..........xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 17 *, 12 monsters
NAME:   vaults_end_grunt_cloverleaf
TAGS:   vaults_end_quadrant
NSUBST: O = 1:O / *:*
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxx+...
xxxxx**..xxxxxxxxx....xxx.x
xxxO*..9...xxxxx...9....x+x
xx*..9.....xxxxx.....9...xx
xx*.........xxx..........xx
xx.9........xxx........9.xx
xx........9..x..9........xx
xxx..........+..........xxx
xxxxx....9.+xxx+.9....xxxxx
xxxxxxxx...x.9.x...xxxxxxxx
xxxxxxxxx+xx9.9xx+xxxxxxxxx
xxxxxxxx...x.9.x...xxxxxxxx
xxxxx....9.+xxx+.9....xxxxx
xxx..........+..........xxx
xx........9..x..9........xx
xx.9........xxx........9.xx
xx*.........xxx.........*xx
xx*..9......xxx......9..*xx
xxxO*..9...xxxxx...9..*Oxxx
xxxxx**..xxxxxxxxx..**xxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 20 *, 14 monsters
NAME:   vaults_end_grunt_tight_spiral
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxx........9............
xxxx....xxxxxxxxxxxxx.....x
xxx...9xx....9......9.....x
xxx.x9.x..xxxxxxxxxx.9....x
xx..x.xx.xx..9.....xxx....x
xx..x.x..x..xxxxxx...xx...x
xx..x.x.xx.xx9...xxx..x...x
xx..x.x.x..xx*xx...xx.x...x
x...x.x.x.xx***xxx..x.x...x
x...x.x.x.x*9*9*xxx.x.x...x
x..9x9x9x9***O***9x9x9x9..x
x...x.x.xxx*9*9*x.x.x.x...x
x...x.x..xxx***xx.x.x.x...x
xx..x.xx...xx*xx..x.x.x..xx
xx..x..xxx...9xx.xx.x.x..xx
xx..xx...xxxxxx..x..x.x..xx
xx...xxx.....9..xx.xx.x..xx
xxx..9.xxxxxxxxxx..x.9x.xxx
xxx...9......9....xx9...xxx
xxxx..xxxxxxxxxxxxx....xxxx
xxxxx........9........xxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 18 *, 12 monsters
NAME:   vaults_end_grunt_simple_division
TAGS:   vaults_end_quadrant
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x*.9.........+.........9..
x...........xxx...........x
x9.........xxOxx.........9x
x....9....xx***xx.....9...x
x.......xxx.9.9.xxx.......x
x......+x.........x+......x
x.....x+...........+x.....x
x...xxx.............xxx...x
x..xx........9........xx..x
x.xx*9...............9*xx.x
x+xO*......9...9......*Ox+x
x.xx*9...............9*xx.x
x..xx........9........xx..x
x...xxx.............xxx...x
x.....x+...........+x.....x
x......+x.........x+......x
x.......xxx.9.9.xxx.......x
x....9....xx***xx.....9...x
x9.........xxOxx.........9x
x...........xxx...........x
xO.9.........+.........9.*x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

###############################################################################
# Vaults:$ prize quadrants
###############################################################################

############################################################
# 11 |, 12 *, 15 monsters
NAME:   vaults_end_minmay_curved2
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x......x|**.....9xxx......
x......xO|*.....xx9.......x
x......xx|*....9x........xx
x...x...xxx....xx........xx
x...x..........x9......9xxx
x...x9........9x.....9xxx9x
x...xx........xx...xxxx9..x
x....x9......9x..xxx9.....x
x....xx9....9xx.xx9.......x
x.....xxx99xxx..x9........x
x.......xxxx...xx.........x
x..............x9.....x***x
x...xxxx.......x9.....x||*x
x.....9xxx.....xx.....xxO|x
x.......9xx.....x9.....xxxx
xxxx.....9x.....xx9.......x
x|Oxx.....xx.....xxx9.....x
x*||x.....9x.......xxxx...x
x***x.....9x..............x
x.........xx..............x
x........9x...............x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 31 *, 18 $, 20 monsters
NAME:    vaults_end_minmay_connected_circles
TAGS:    vaults_end_quadrant_prize
SUBST:   9 = 8 9 .:20
NSUBST:  * = 1:O / *:*
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xx$9$xxxxxx.9xxxxxxxxxxxx.
x$.$.$xxxx9...xxxxxxxxxx.xx
x9$.$9xxxx...9xxxxxxxxx.xxx
x$.$.$xxx.x9.xxxxxxxxx.xxxx
xx$9$xxx.xxxx.xxx.9.x.xxxxx
xxx.xxx.xx$9xx.x.....xxxxxx
xxxx.x.xx$.$9xx.9...9xxxxxx
xxx.9.xxx9$.$xxx.....xxxxxx
xx.....x.x9$xxxxx.9.x.xxxxx
xx9...9.xxxxxxxxxx.xxx.xxxx
xx.....x.xxxxxxxx.xxxxx.9xx
xxx.9.xxx.xxxxxx.xxxxx9...x
xxxxxxxxxx.xxxx.xxxxx....9x
xxx9*.*xxxx.9x.xxxxx.xx9.xx
xx.*.*.*xx9...xxxxx.xxxxxxx
x.*.*.*.*x...9xxxx.xxx*9xxx
x*.*.*.*9xx9.xx.9.xxx*.*9xx
x9*.*.*.*x.xxx.....xx9*.*xx
x*.*.*.*..xxxx9...9x.x9*xxx
xx*.*.*.xxxxxx......xxxxxxx
xxx*.*9xxxxxxxx.9.xxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 3 |, 24 *, 18 monsters
NAME:   vaults_end_minmay_x
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxxxx
 .........................x
x..xx9...............9xx..x
x..xxx...............xxx..x
x..9xxx.............xxx9..x
x....xxx...........xxx....x
x.....xxx.........xxx.....x
x......xxx9999999xxx......x
x......9xxx*****xxx9......x
x......9*xxx***xxx*9......x
x......9**xxxOxxx**9......x
x......9**OxxxxxO**9......x
x......9**xxxOxxx**9......x
x......9*xxx***xxx*9......x
x......9xxx*****xxx9......x
x......xxx9999999xxx......x
x.....xxx.........xxx.....x
x....xxx...........xxx....x
x..9xxx.............xxx9..x
x..xxx...............xxx..x
x..xx9...............9xx..x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 20 *, 16 monsters
NAME:   vaults_end_minmay_split_x
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xx9......9xxxxxxx9........
x9.........xxxxx..........x
x..xxxxx....xxx....xxxxx..x
x..xxx..x...9x9...x..xxx..x
x..xx|...x.......x...|xx..x
x..x..9...x.....x...9..x..x
x..x...9..x.....x..9...x..x
x...x...|xx9...9xx|...x...x
x9...x..xxxx***xxxx..x...9x
xx....xxxxx*****xxxxx....xx
xxx9..xxxxx**O**xxxxx..9xxx
xx....xxxxx*****xxxxx....xx
x9...x..xxxx***xxxx..x...9x
x...x...|xx9...9xx|...x...x
x..x...9..x.....x..9...x..x
x..x..9...x.....x...9..x..x
x..xx|...x.......x...|xx..x
x..xxx..x...9x9...x..xxx..x
x..xxxxx....xxx....xxxxx..x
x9.........xxxxx.........9x
xx9......9xxxxxxx9......9xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 18 |, 12 *, 21 monsters
NAME:   vaults_end_minmay_slanted
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xO|||||||||.....9.....xxxxx
x||||||xxxx..9..9..xxxx***x
x|||xxxx..9..9..xxxx......x
xxxxx.....9..xxxx.........x
x.........xxxx..9.........x
x......xxxx..9..9..xxxx999x
x999xxxx..9..9..xxxx......x
x.........9..xxxx.........x
x.........xxxx..9.....xxxxx
x......xxxx..9..9..xxxx***x
x***xxxx..9..9..xxxx......x
xxxxx.....9..xxxx.........x
x.........xxxx..9.........x
x......xxxx..9..9..xxxx999x
x999xxxx..9..9..xxxx......x
x.........9..xxxx.........x
x.........xxxx..9.....xxxxx
x......xxxx..9..9..xxxxxxxx
x***xxxx..9..9..xxxxxxxxxxx
xxxxx.....9..xxxxxxxxxxxxxx
 .........xxxxxxxxxxxxxxxxx
  xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 |, 14 *, 20 monsters
NAME:    vaults_end_minmay_not_circular
TAGS:    vaults_end_quadrant_prize
SHUFFLE: abcd
SUBST:   a : ., b : x .:1, c : x .:1, d : x .:1
SUBST:   9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  xxxxxxxxxxxxxxxxxxxxxxxxx
 .................xxxxxxxxx
x...................9xxxxxx
x.....................9xxxx
x.......9xxcccccxx.....9xxx
x....9xxxx9.....9xxxx...xxx
x...9xx9...........9xx..9xx
x...xx...............xx..xx
x..9x9...xxaaaaaxx...9x..xx
x..xx..xxx9.....9xxx..xx.*x
x..d9.xx9..|||||..9xx.9b.*x
x..d..b...|||O|||...d..b.*x
x..d9.xx9..|||||..9xx.9b.*x
x..xx..xxx9.....9xxx..xx.*x
xx..x9...xxcccccxx...9x..xx
xx..xx...............xx..xx
xx9..xx9...........9xx..9xx
xxx...xxxx9.....9xxxx...xxx
xxx9.....xxaaaaaxx.....9xxx
xxxx9.................9xxxx
xxxxxx9.............9xxxxxx
xxxxxxxxx*********xxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 25 |
NAME:   vaults_end_mu_corners
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:10
NSUBST: $ = 1:O / *:$
SUBST:  $ = | *:20 $
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x$$$$x.......x99...x..$$$$x
x$$$$x.......x99...x.x$$$$x
x$$$$x..xxx..x..x..x.x$$$$x
x$$$$x..xxx..x..x..x.x$$$$x
x.xxxx..xxx..x..x..x.xxxxxx
x.......xxx.....x99.......x
xxxxxx..xxx.....x99.......x
x.......xxxxxxxxxxxxxxxx..x
x.......x99...$$$$x99.....x
x..xxxxxx99xxx$$$$x99.....x
x99.....x..xxx$$$$x..xxxxxx
x99.....x..xxx$$$$x.....99x
xxxxxx..x..xxxxxxxx.....99x
x.......x..xxxxxxxxxxxxx..x
x.......x.................x
x..xxxxxx.................x
x99.....x..xxxxxxxxx.xxxxxx
x99.....x..xxx$$$$xx.x$$$$x
xxxxxx..x..xxx$$$$xx.x$$$$x
a.......x99xxx$$$$xx.x$$$$x
 .......x99...$$$$xx..$$$$x
  axxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 21 |
NAME:   vaults_end_mu_flips
TAGS:   vaults_end_quadrant_prize
NSUBST: ; = 3:l / 3:z / 3:A / *:.
SUBST:  9 = 8 9
SUBST:  $ = | * $
KFEAT:  l = teleport trap
KFEAT:  z = zot trap
KFEAT:  A = alarm trap
SUBST:  s = x:250 +:1
SUBST:  a = x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x999......................x
x999xxxxxxxxxxxxxxxxxxxxs.x
x999....................x.x
x.x.xxxxxxxxxxxxxxxxxxs.x.x
x.x.x999..............x.x.x
x.x.x999xxxxxxxxxxxxs.x.x.x
x.x.x999;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x;;;;;;;;;$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$$x.x.x.x
x.x.x.x$$$$$$$$$$$$Ox.x.x.x
x.x.x.sxxxxxxxxxxxxxx.x.x.x
x.x.x................999x.x
x.x.sxxxxxxxxxxxxxxxx999x.x
x.x..................999x.x
x.sxxxxxxxxxxxxxxxxxxxxxx.a
x.........................
xxxxxxxxxxxxxxxxxxxxxxxxa
ENDMAP

############################################################
# about 21 |
NAME:   vaults_end_mu_construction
TAGS:   vaults_end_quadrant_prize
NSUBST: $ = 1:O / *:$
SUBST:  $ = |*$.
SUBST:  c = xn9.
SUBST:  9 = 8 9 .
NSUBST: D = 1:+ / *:x
SUBST:  a = xn..
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
  axxxxxxxxxxxxxxxxxxxxxxxx
 ..c.c.c.c.c.c.c.c.c.c.c.cx
a.c.c.c.c.c.c.c.c.c.c.c.c.x
xc.c.c.c.c.c.c.c.c.c.c.c.cx
x.c.c.c.c.c.c.c.c.c.c.c.c.x
xc.c.c.c.c.c.c.c.c.c.c.c.cx
x.c.c.c.c.c.c.c.c.c.c.c.c.x
xc.c.c.c.c.c.c.c.c.c.c.c.cx
x.c.c.c.c.c.c.c.c.c.c.c.c.x
xc.c.c.c.c.c.c.c.c.c.c.c.cx
x.c.c.c.c.c.c.c.c.c.c.c.c.x
xDxDxDxDxDxDxDxDxDxDxDxDxDx
x.........................x
x.........................x
x.9x..x..x..x9x..x..x..x9.x
x.........................x
x.........................x
xxx+xxxx+xxxx+xxxx+xxxx+xxx
x$$$$x$$$$$x$$$x$$$$$x$$$$x
x$$$$x$$$$$x$$$x$$$$$x$$$$x
x$$$$x$$$$$x$$$x$$$$$x$$$$x
x$$$$x$$$$$x$$$x$$$$$x$$$$x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# about 19 |
NAME:   vaults_end_mu_triangles
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: ? = 1:O / *:|
SUBST:  " = +:1 x:99
SUBST:  ! = x:20 .
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x.........................x
x.!x..9..xx............x!.x
x..xx.....xx.9...9..9.xx..x
x...xx..9..xx........xx.9.x
x....xx.....xx.9..9.xx....x
x..9..xx..9..xx****xx.9...x
x......xx.....xx**xx......x
x....9..xx..9.."xxx|9.....x
x........xx.....xx||....9.x
x......9.|x"..9.."x|9.....x
x..9.....*|xx.....xx......x
x......9.|xxx"..9..xx.9...x
x........xx||xx.....xx....x
x....9..xx||||xx..9..xx.9|x
x......xx..9.9.xx.....xx||x
x..9..xx........xx..9..xx?x
x....xx..9.....9.xx.....xxx
x...xx............xx..9..xx
x..xx..9....9....9.xx.....x
x.!x...............|xx....x
x..................|?xx...
xxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Two guaranteed good shops. Perhaps more shops.
# Almost all monsters are in the rooms.
NAME:    vaults_end_dpeg_mall
TAGS:    vaults_end_quadrant_prize vaults_end_quadrant_prize_mall
SHUFFLE: AB, CD
SUBST:   A=+, B:xx+, C:xxx+, D:xxxx+
NSUBST:  S = 2:S / 1:O / *:RRU9
KFEAT:   S = jewellery shop / antique armour shop / wand shop
KFEAT:   R = general shop / book shop / scroll shop / antique weapon shop / distillery shop
KFEAT:   U = stone_arch
NSUBST:  ' = 22:9 / *:.
NSUBST:  . = 2:9 / *:.
SUBST:   9 = 8 9
SUBST:   a : x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxx'''x...........x
xxxxxxx'''D'S'x...........x
x'''''B'S'D'''x...........x
x''S''B'''x+++x....xxx....x
x'''''x+++x........xxx....x
xxAAAxx............xxx....x
xx'''+....................x
xx'S'+...T................x
xx'''+....................x
xxCCxx....................x
x'''+.....................x
x'S'+.....................x
x'''+.....................x
xxxxx.....................x
x.........................x
x.........................x
x...xxx...................x
x...xxx...................x
x...xxx...................a
x.........................a
x.........................
xxxxxxxxxxxxxxxxxxxxxxxaa
ENDMAP

############################################################
# 27 *, 1 |, 16 monsters
NAME:   vaults_end_minmay_bent_boxes
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.....9............9......
x.....9............9......x
x.....xxxxxxxxxxxxxx......x
x................9.xx.....x
x................9..xx....x
x99x.....xxxxxxxxx...xx...x
x..x....xx.9..........xx99x
x..x...xx..9...........x..x
x..x..xx...xxxxxxx..x99x..x
x..x..x....******x..x..x..x
x..x..x99x***O***x99x..x..x
x..x..x..x******....x..x..x
x..x99x..xxxxxxx...xx..x..x
x..x...........9..xx...x..x
x99xx..........9.xx....x..x
x...xx...xxxxxxxxx.....x99x
x....xx..9................x
x*....xx.9................x
x**....xxxxxxxxxxxxxx.....x
x***...9............9.....x
xO***..9............9.....x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 28 *, 1 |, 20 monsters
NAME:   vaults_end_minmay_cup_spider
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.........................x
x..xxxx..xxxxxxxxx..xxxx..x
x.....x..9..*x*..9..x.....x
x.....x..9..*x*..9..x.....x
x..x99xxxxxxxxxxxxxxx99x..x
x..x..x**xO.....Ox**x..x..x
x..x**x..xx..x..xx..x**x..x
x..xxxx99xx99x99xx99xxxx..x
x........x.......x........x
x........x.......x........x
x..xxxx99xx99x99xx99xxxx..x
x..xxxx..xx..x..xx..xxxx..x
x..9.*x..x.......x..x*.9..x
x..9.*x**x.......x**x*.9..x
x..xxxxxxxx..x..xxxxxxxx..x
x..x**x**x.......x**x**x..x
x..x..x..x.......x..x..x..x
x..x99x99xx99x99xx99x99x..x
x.........................x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 18 *, 20 monsters
NAME:   vaults_end_minmay_30_sandwiches
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9...9...9...9...9...9....
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..*..x*x..*..x*x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x9...9...9...9...9...9...9x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x..*..x|x..|..x|x..|..x*x.x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x9...9...9...9...9...9...9x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..|..x|x..|..x|x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x9...9...9...9...9...9...9x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x..*..x|x..|..x|x..|..x*x.x
x.xxx.x.x.xxx.x.x.xxx.x.x.x
x9...9...9...9...9...9...9x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x.x*x..*..x*x..*..x*x..*..x
x.x.x.xxx.x.x.xxx.x.x.xxx.x
x....9...9...9...9...9...9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 16 *, 18 monsters
NAME:   vaults_end_minmay_small_xes
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x.xx9..9xx.......xx9..9xx.x
x.xxx**xxx.......xxx**xxx.x
x.9xxxxxx9.xxxxx.9xxxxxx9.x
x..*xxxx*..x|||x..*xxxx*..x
x..*xxxx*..x|||x..*xxxx*..x
x.9xxxxxx9.xx+xx.9xxxxxx9.x
x.xxx**xxx.......xxx**xxx.x
x.xx9..9xx.xx9xx.xx9..9xx.x
x..........xxxxx..........x
x..........9xxx9..........x
x..........xxxxx..........x
x.xx9..9xx.xx9xx.xx9..9xx.x
x.xxx**xxx.......xxx**xxx.x
x.9xxxxxx9.xx+xx.9xxxxxx9.x
x..*xxxx*..x|||x..*xxxx*..x
x..*xxxx*..x|||x..*xxxx*..x
x.9xxxxxx9.xxxxx.9xxxxxx9.x
x.xxx**xxx.......xxx**xxx.x
x.xx9..9xx.......xx9..9xx.x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 12 *, 16 monsters
NAME:   vaults_end_minmay_plusses
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: | = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxxxx.....8x8.......8x8...
xxx........x.........x....x
xx....x.........x.........x
xx...9x9.......9x9.......8x
x...xxxxx..x..xxxxx..x..xxx
x....9x9.......9x9.......8x
xxxx..x.........x.........x
x||x.......x.........x....x
x**x......9x9.......9x9...x
x.....x..xxxxx..x..xxxxx..x
x**x......9x9.......9x9...x
x||x.......x.........x....x
xxxx..x.........x.........x
x....9x9.......9x9.......8x
x...xxxxx..x..xxxxx..x..xxx
x....9x9.......9x9.......8x
x.....x.........x.........x
xx.......................xx
xx....xxxxx.....xxxxx....xx
xxx...*|x|*.....*|x|*...xxx
xxxxx.*|x|*.....*|x|*.xxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 11 |, 16 *, 16 monsters
NAME:   vaults_end_minmay_circles_and_squares
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x.........................
x..xx9..9xx.....xx9..9xx..x
x.xxxx..xxxx...xxxx..xxxx.x
x.xxxx..xxxx...xxxx..xxxx.x
x.9xx....xx9...9xx....xx9.x
x.....||...........||.....x
x.9xx....xx9...9xx....xx9.x
x.xxxx..xxxx...xxxx..xxxx.x
x.xxxx..xxxx...xxxx..xxxx.x
x..xx9..9xx.....xx9..9xx..x
x.....xx...........xx.....x
x..xx9xx9xx.....xx9xx9xx..x
x..xx....xx.....xx....xx..x
x..9..**..9.....9..**..9..x
x.xx.*OO*.xx...xx.*OO*.xx.x
x.xx.*OO*.xx...xx.*OO*.xx.x
x..9..**..9.....9..**..9..x
x..xx....xx.....xx....xx..x
x..xx9xx9xx.....xx9xx9xx..x
x.....xx...........xx.....x
x.........................x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 14 |, 6 *, 20 monsters
NAME:   vaults_end_minmay_odd_checkers
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x9999x......xx......xx....
x....x......xx......xx....x
x....9..xx...9..xx....9...x
x....9..xx...9..xx.....9..x
x....x......xx..........xxx
x....x......xx..9.......xxx
x.99.x..xx.......9..xx....x
x....x..xx..........xx....x
x....x....9.....xx..9...xxx
x....x.....9....xx..9...xxx
x....x......xx......xx....x
x....x......xx......xx....x
x...9x99xx......xx......xxx
x..9.x*.xx......xx......xxx
x.9..x|*.9......9........9x
x9...x||*9......9........9x
xxxx.xxxxxxxxxxxxxxxxx..xxx
x||*.....9...............9x
x||**x..9............9...9x
x||||x.9.............9...9x
xO|||x9..................9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 8 |, 19 *, 18 monsters
NAME:   vaults_end_minmay_bends
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x**|Ox9...9x9....x9.......
x.**|x.9.9.x.9...x.9......x
x..**x..x..x..x..x..xxxx..x
x...*x..x..x..x..x.....x..x
x9xxxx..x..x..x..x.....x..x
x...9x..x..x..x..x..x..x..x
x..9.x..x..x..x...9.....9.x
x.9..x..x..x..x....9.....9x
x9...x..x..x..xxxx..xxxxxxx
x....x..x..x9....x........x
x....x..x..x.9...x........x
x....x..x..x..x..xxxxxxx..x
x....x..x9.....9........9.x
x....x..x.9.....9........9x
x....x..xxxx..xxxxxxxxxxxxx
x....x....9x9............9x
x....x...9.x.9..........9.x
x....xxxx..xxxxxxxxxxxxx..x
x...9......x.**|OxO|**.x..x
x..9.......x..**|x|**..x..x
x.9........9...**x**...9..x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 7 |, 18 *, 20 monsters
NAME:   vaults_end_minmay_plus_grid_2
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
NSUBST: O = 1:O / *:|
SUBST:  X : x., Y : x.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xx*O*x.9.x.9.x.9.x.9.x.9.x
x*x*x.x.x.x.x.x.x.x.x.x.x.x
xO*x.9.x.9.x...x.9.x.9.x.9x
x*x.x.x.x.xYx.xYx.x.x.x.x.x
xx.9.x.9.xYYYxYYYx.9.x.9.xx
x.x.x.x.xXxYxYxYxXx.x.x.x.x
x9.x.9.xXXXxYYYxXXXx.9.x.9x
x.x.x.xYxXxXxYxXxXxYx.x.x.x
xx.9.xYYYxXXXxXXXxYYYx.9.xx
x.x.xXxYxYxXxXxXxYxYxXx.x.x
x9.xXXXxYYYxXXXxYYYxXXXx.9x
x.x.xXxYxYxXxXxXxYxYxXx.x.x
xx.9.xYYYxXXXxXXXxYYYx.9.xx
x.x.x.xYxXxXxYxXxXxYx.x.x.x
x9.x.9.xXXXxYYYxXXXx.9.x.9x
x.x.x.x.xXxYxYxYxXx.x.x.x.x
xx.9.x.9.xYYYxYYYx.9.x.9.xx
x*x.x.x.x.xYx.xYx.x.x.x.x*x
xO*x.9.x.9.x...x.9.x.9.x*Ox
x*x*x.x.x.x.x.x.x.x.x.x*x*x
xx*O*x.9.x.9.x.9.x.9.x*O*xx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 8 |, 16 monsters
NAME:   vaults_end_minmay_odd_hourglass
TAGS:   vaults_end_quadrant_prize
SUBST:  9 = 8 9 .:20
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
x....9x.................x.
x....x.x...............x9xx
x....xx9x.............x.xxx
x...x.xx.x...........x9xx.x
x...9..xx9x.........x.xx..x
x...x...xx.x.......x9xx...x
x........xx9x.....x.xx..x9x
x...x.....xx.x...x9xx..xx9x
x...9......xxxxxxxxx..xx*.x
x...x......9.9..9.9..xx**.x
x...................xx|**.x
x...x......9.9..9.9xx||**.x
x...9......xxxxxxxxxO||**.x
x...x.....xx9x...x.xx||**.x
x........xx.x.....x9xx|**.x
x...x...xx9x.......x.xx**.x
x...9..xx.x.........x9xx*.x
x...x.xx9x...........x.xx9x
x....xx.x.............x9x9x
x....x9x...............x..x
x.....x.................x9x
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# 16 *, 10 |, 16 monsters
NAME:    vaults_end_nooodl_tilted_maze
TAGS:    vaults_end_quadrant_prize
SUBST:   9 = 8 9 .:10
NSUBST:  O = 1:O / *:|
SUBST:   * = * $:4
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xO***$...9...xx..xx.......
x*||*$...xx..xx...9....9..x
x****xx..xx...x.......xxxxx
xxx$$xx.......x.9.xx..xx..x
xxx.......9...xx..xx......x
x.9.......xxxxxx...x.9....x
x.....xx..xx.9.....x...xx.x
x.xx..xx...........xxxxxx.x
xxxx...x.9.....xx..xx.9...x
x....9.x...xxxxxx.........x
x......xxxxxx...x.......xxx
x..xxxxxx....9..x...xx..xxx
x9.xx....9......xxxxxx...9x
x...9.......xx..xx..9.....x
x.......xxxxxx...x.......xx
x...xx..xx...9...x...xx$$xx
xx..xx..9x.......xx..xx***x
x*$......x...xxxxxx...$*|*x
x|*$.....xx..xx..9....$*|*x
x$|*$xx..xx...........xx|*x
xO$|*xx9..x9......xx..xx*Ox
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

# 21 |, 20 monsters
NAME:    vaults_end_grunt_nonplussed
TAGS:    vaults_end_quadrant_prize
NSUBST:  9 = 10:8 / 10:9 / *:.
NSUBST:  O = 1:O / *:|
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
xxxxxxxxxxxxxxxxxxxxxxxxx
xxOxxx|xxx|xxx|xxx|xxx|x..
xO9.x.9.x.9.x.9.x.9.x.9.x.x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
x|9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9|x
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xO9.x.9.x.9.x.9.x.9.x.9.xxx
xx.x.x.x.x.x.x.x.x.x.x.x.xx
xxx.9.x.9.x.9.x.9.x.9.x.9Ox
xxxxOxxx|xxx|xxx|xxx|xxxOxx
xxxxxxxxxxxxxxxxxxxxxxxxxxx
ENDMAP

############################################################
# Vaults:$ - Rooms Quadrant
#
# This quadrant uses a subvault for each room. Any subvault tagged
# vaults_end_room_rune should be guaranteed to provide a rune. Any subvault
# tagged vaults_end_room should just provide loot. Note that the rooms
# are not all the same sizes.
#
# about 24 |
NAME:     vaults_end_classical_rooms
TAGS:     vaults_end_quadrant_prize
SHUFFLE:  AC/BD, EG/FH, IKN/MJL
SUBST:    A=., B=xx+, C=+, D=x, E=+, F=xx+, G=., H=x
SUBST:    I=., M=xx+, J=x, K=+, N=+, L=xx+
SUBST:    a:x.
SHUFFLE:  VXYZ
SUBVAULT: V : vaults_end_room_rune
SUBVAULT: X : vaults_end_room
SUBVAULT: Y : vaults_end_room
SUBVAULT: Z : vaults_end_room
SUBST:    VXYZ = .
MAP
xxxxxxxxxxxxxxxxxxxxxxxxxxx
x.........................x
x.xxxxxxxxxxx..xxxxxxxxJxIx
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVx..xXXXXXXXXx.x
x.xVVVVVVVVVL..KXXXXXXXXx.x
x.NVVVVVVVVVxxxxxxxxxxxxx.x
xMxxxxxxxxxxx99988......A.x
x...........G99xxxxxxxxDx.x
x.xxxxxxxxxFx99xZZZZZZZZx.x
x.xYYYYYYYYYx88xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..xZZZZZZZZx.x
x.xYYYYYYYYYx..CZZZZZZZZx.x
x.xxxxxxxxxEx..xxxxxxxxxx.a
x...........H..B..........
xxxxxxxxxxxxxxxxxxxxxxxxa
ENDMAP

# Vaults:$ - Rooms Quadrant - Traps and Loot Subvault
#            Replace each square with traps or loot, but mostly floor.
NAME: vaults_end_room_traps_and_loot
TAGS: vaults_end_room
: default_subvault_glyphs()
SUBST: . = ?
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Border Subvault
#            Fill the room with loot, but leave an empty border.
NAME: vaults_end_room_border
TAGS: vaults_end_room
{{
    default_subvault_glyphs()
    local w, h = subvault_size()

    local i
    for i in iter.subvault_iterator(_G) do
      if i.x == 0 or i.x == w-1 or i.y == 0 or i.y == h-1 then
        -- border
        mapgrd[i.x][i.y] = '.'
      else
        -- inside
        mapgrd[i.x][i.y] = '*'
      end
    end
}}
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Diamond Subvault
#            Fill the room with money in a diamond pattern.
NAME: vaults_end_room_diamond
TAGS: vaults_end_room
{{
    default_subvault_glyphs()
    local w, h = subvault_size()

    local i
    for i in iter.subvault_iterator(_G) do
      if (i.x + i.y) % 2 == 0 then
        mapgrd[i.x][i.y] = '$'
      else
        mapgrd[i.x][i.y] = '.'
      end
    end
}}
: vaults_end_loot(_G)
MAP
ENDMAP

# Vaults:$ - Rooms Quadrant - Rune Subvault
#            Potentially contains the rune.
NAME: vaults_end_room_rune
TAGS: vaults_end_room_rune
SUBST: ^ = ^.
: vaults_end_loot(_G)
: vaults_end_rune(_G)
MAP
......
.^^^^.
.^||^.
.^O|^.
.^||^.
.^^^^.
......
ENDMAP
